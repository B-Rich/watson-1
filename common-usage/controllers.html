<!doctype html>
<html>
	<head>
		<title>Controllers -  Common Usage -  Watson Documentation</title>
		<link rel="stylesheet" type="text/css" href="/watson/assets/css/main.css" />
		<link rel="stylesheet" type="text/css" href="/watson/assets/css/pygments.css" />
		<meta name="viewport" content="initial-scale=1, user-scalable=no, width=device-width" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	</head>
	<body>
		<a href="https://github.com/simoncoulton/watson"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>
<header>
	<nav class="wrapper primary">
		<a href="/watson/">Watson<span>It's elementary my dear Watson</span></a>
		<a href="/watson/reference-library">Reference Library</a>
		<a href="/watson/key-concepts">Key Concepts</a>
		<a href="/watson/getting-started">Getting Started</a>
	</nav>
	<div class="pagetitle">
		<div class="wrapper">Documentation: Common Usage</div>
	</div>
</header>
		<div>
			<div class="wrapper main clearfix">
				<nav class="secondary">
	<ul>
		<li>
			Getting Started
			<ul>
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			      <li>
			        <a href="/watson/getting-started/installation.html">
			          Installation
			        </a>
			      </li>
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			      <li>
			        <a href="/watson/getting-started/configuration.html">
			          Configuration
			        </a>
			      </li>
			    
			  
			    
			  
			    
			  
			    
			      <li>
			        <a href="/watson/getting-started/your-first-application.html">
			          Your First Application
			        </a>
			      </li>
			    
			  
			</ul>
		</li>
		<li>
			Key Concepts
			<ul>
				
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			      <li>
			        <a href="/watson/key-concepts/events.html">
			          Events
			        </a>
			      </li>
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			      <li>
			        <a href="/watson/key-concepts/dependencyinjection.html">
			          Dependency Injection
			        </a>
			      </li>
			    
			  
			    
			      <li>
			        <a href="/watson/key-concepts/mvc.html">
			          Mvc
			        </a>
			      </li>
			    
			  
			    
			  
			</ul>
		</li>
		<li>
			Common Usage
			<ul>
				
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			      <li class="active">
			        <a href="/watson/common-usage/controllers.html">
			          Controllers
			        </a>
			      </li>
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			      <li>
			        <a href="/watson/common-usage/requests.html">
			          Requests
			        </a>
			      </li>
			    
			  
			    
			      <li>
			        <a href="/watson/common-usage/routing.html">
			          Routing
			        </a>
			      </li>
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			      <li>
			        <a href="/watson/common-usage/views.html">
			          Views
			        </a>
			      </li>
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			</ul>
		</li>
		<li>
			Advanced Topics
			<ul>
				
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			      <li>
			        <a href="/watson/advanced-topics/deployment.html">
			          Deployment
			        </a>
			      </li>
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			</ul>
		</li>
		<li>
			Reference Library
			<ul>
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				<li>
					<a href="/watson/reference-library/cache">watson.cache</a>
				</li>
				
				
				
				
				
				
				
				
				
				
				
				<li>
					<a href="/watson/reference-library/common">watson.common</a>
				</li>
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				<li>
					<a href="/watson/reference-library/di">watson.di</a>
				</li>
				
				
				
				
				
				
				
				
				
				
				
				<li>
					<a href="/watson/reference-library/events">watson.events</a>
				</li>
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				<li>
					<a href="/watson/reference-library/filters">watson.filters</a>
				</li>
				
				
				
				
				
				
				<li>
					<a href="/watson/reference-library/form">watson.form</a>
				</li>
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				<li>
					<a href="/watson/reference-library/html">watson.html</a>
				</li>
				
				
				
				
				
				
				
				
				
				
				
				<li>
					<a href="/watson/reference-library/http">watson.http</a>
				</li>
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				<li>
					<a href="/watson/reference-library/mvc">watson.mvc</a>
				</li>
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				<li>
					<a href="/watson/reference-library/util">watson.util</a>
				</li>
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				<li>
					<a href="/watson/reference-library/validators">watson.validators</a>
				</li>
				
				
				
				
			</ul>
		</li>
	</ul>
</nav>
			    <div class="content">
			    	<h2 class="section-title">Controllers</h2>
					<p><section></p>

<p>Watson provides two different types of controllers which are called Action and Rest respectively. Each one has its own uses and there is no one size fits all solution.</p>

<h3>Creating controllers</h3>

<h4><a id="action"></a>Action controllers</h4>

<p>Action controller methods are defined explicitly within the applications route configuration. In the following example, when a request is made to <code>/</code> then the <code>app_name.controllers.Public</code> controller is initialized, and the <code>indexAction</code> method is invoked.</p>

<p><span class="sub">app_name/config/config.py</span></p>

<div class="highlight"><pre><code class="python"><span class="n">routes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;index&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;path&#39;</span><span class="p">:</span> <span class="s">&#39;/&#39;</span><span class="p">,</span>
        <span class="s">&#39;defaults&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;controller&#39;</span><span class="p">:</span> <span class="s">&#39;app_name.controllers.Public&#39;</span><span class="p">,</span> <span class="s">&#39;action&#39;</span><span class="p">:</span> <span class="s">&#39;index&#39;</span><span class="p">}</span>
    <span class="p">},</span>
<span class="p">}</span>
</code></pre></div>

<p><span class="sub">app<em>name/controllers/</em><em>init</em>_.py</span></p>

<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">watson.mvc</span> <span class="kn">import</span> <span class="n">controllers</span>

<span class="k">class</span> <span class="nc">Public</span><span class="p">(</span><span class="n">controllers</span><span class="o">.</span><span class="n">Action</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">index_action</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</code></pre></div>

<h4><a id="rest"></a>RESTful controllers</h4>

<p>RESTful controller methods are based upon the HTTP request method that was made by the user. In the following example, when a request is made to <code>/</code> the <code>app_name.controllers.User</code> controller is initialized, and the relevant HTTP request method is invoked.</p>

<p><span class="sub">app_name/config/config.py</span></p>

<div class="highlight"><pre><code class="python"><span class="n">routes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;index&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;path&#39;</span><span class="p">:</span> <span class="s">&#39;/&#39;</span><span class="p">,</span>
        <span class="s">&#39;defaults&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;controller&#39;</span><span class="p">:</span> <span class="s">&#39;app_name.controllers.User&#39;</span><span class="p">}</span>
    <span class="p">},</span>
<span class="p">}</span>
</code></pre></div>

<p><span class="sub">app<em>name/controllers/</em><em>init</em>_.py</span></p>

<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">watson.mvc</span> <span class="kn">import</span> <span class="n">controllers</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">controllers</span><span class="o">.</span><span class="n">Rest</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">GET</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">POST</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">PUT</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">DELETE</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>
</code></pre></div>

<h3>Common tasks</h3>

<h4>Accessing Request and Response objects</h4>

<p>No changes should be made to the request object, and they should be treated as immutable. However any modifications can be made to the response object, as it will be used when the application renders the response to the user.</p>

<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">watson.mvc</span> <span class="kn">import</span> <span class="n">controllers</span>

<span class="k">class</span> <span class="nc">Controller</span><span class="p">(</span><span class="n">controllers</span><span class="o">.</span><span class="n">Rest</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">GET</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span>  <span class="c"># the watson.http.messages.Request object</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span>  <span class="c"># the</span>
</code></pre></div>

<p>For more information on request and response objects see the <a href="/watson/reference-library/http/messages.html">reference library</a>.</p>

<h4>Redirecting a request to another route or url</h4>

<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">watson.mvc</span> <span class="kn">import</span> <span class="n">controllers</span>

<span class="k">class</span> <span class="nc">Controller</span><span class="p">(</span><span class="n">controllers</span><span class="o">.</span><span class="n">Rest</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">GET</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redirect</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>  <span class="c"># redirect the user to specific url</span>

    <span class="k">def</span> <span class="nf">POST</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redirect</span><span class="p">(</span><span class="s">&#39;home&#39;</span><span class="p">)</span>  <span class="c"># redirect the user to a named route</span>
</code></pre></div>

<p>For more information on the various arguments that can be passed to redirect() see the <a href="/watson/reference-library/mvc/controllers.html">reference library</a>.</p>

<p>When a user is redirected, any POST or PUT variables will be saved within the users session to solve the PRG (<a href="http://en.wikipedia.org/wiki/Post/Redirect/Get">Post Redirect Get</a>) issue. These variables may then be accessed to populate a form for example and are stored within the <code>redirect_vars</code> attribute of the controller. They can subsequently be cleared via the <code>clear_redirect_vars()</code> method on the controller.</p>

<h4>Flash messaging</h4>

<p>Flash messaging is a way to send messages between requests. For example, a user may submit some form data to be saved, at which point the application would</p>

<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">watson.mvc</span> <span class="kn">import</span> <span class="n">controllers</span>
<span class="kn">from</span> <span class="nn">app_name</span> <span class="kn">import</span> <span class="n">forms</span>

<span class="k">class</span> <span class="nc">Controller</span><span class="p">(</span><span class="n">controllers</span><span class="o">.</span><span class="n">Rest</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">GET</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s">&#39;form&#39;</span><span class="p">:</span> <span class="n">forms</span><span class="o">.</span><span class="n">Login</span><span class="p">(),</span>  <span class="c"># form has a POST method</span>
            <span class="s">&#39;flash_messages&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">flash_messages</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">POST</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">Login</span><span class="p">()</span>
        <span class="n">form</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">post</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flash_messages</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;Successfully logged in&#39;</span><span class="p">,</span> <span class="s">&#39;info&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flash_messages</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;Invalid username or password&#39;</span><span class="p">,</span> <span class="s">&#39;error&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">redirect</span><span class="p">(</span><span class="s">&#39;login&#39;</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        {% for namespace, message in flash_messages %}
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;{{ namespace }}&quot;</span><span class="nt">&gt;</span>{{ message }}<span class="nt">&lt;/div&gt;</span>
        {% endfor %}
        {{ form.open() }}
        {{ form.username.render_with_label() }}
        {{ form.password.render_with_label() }}
        {{ form.submit }}
        {{ form.close() }}
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>

<p>Once flash messages have been iterated over, they are automatically cleared from the flash message container.</p>

<h4>404 and other http errors</h4>

<p>Raising 404 Not Found errors and other HTTP error codes are simple to do directly from the controller.</p>

<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">watson.mvc</span> <span class="kn">import</span> <span class="n">controllers</span><span class="p">,</span> <span class="n">exceptions</span>

<span class="k">class</span> <span class="nc">Controller</span><span class="p">(</span><span class="n">controllers</span><span class="o">.</span><span class="n">Rest</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">GET</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">NotFoundError</span><span class="p">()</span>
</code></pre></div>

<p>To raise a custom error code, you can raise an ApplicationError with a message and code specified.</p>

<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">watson.mvc</span> <span class="kn">import</span> <span class="n">controllers</span><span class="p">,</span> <span class="n">exceptions</span>

<span class="k">class</span> <span class="nc">Controller</span><span class="p">(</span><span class="n">controllers</span><span class="o">.</span><span class="n">Rest</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">GET</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">ApplicationError</span><span class="p">(</span><span class="s">&#39;Some horrible error&#39;</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">418</span><span class="p">)</span>
</code></pre></div>

<p></section></p>

				</div>
			</div>
		</div>
		<footer>
	<div class="sub">
		<div class="wrapper clearfix">
			<ul>
				<li class="title">Source </li>
				<li><a href="https://github.com/simoncoulton/watson">GitHub</a></li>
				<li><a href="https://pypi.python.org/pypi/watson-framework/">Pypi</a></li>
			</ul>
			<ul>
				<li class="title">Testing</li>
				<li><a href="https://coveralls.io/r/simoncoulton/watson">Coverage</a></li>
				<li><a href="https://travis-ci.org/simoncoulton/watson">Travis CI</a></li>
			</ul>
			<ul>
				<li class="title">Useful Resources</li>
				<li><a href="http://docs.python.org/3/">Python 3 Documentation</a></li>
				<li><a href="http://www.reddit.com/r/python">Python Subreddit</a></li>

			</ul>
		</div>
	</div>
	<div class="wrapper">
		Design thanks to <a href="http://www.blazrobar.com">Blaz Robar</a>
		<br />Content generated by <a href="https://github.com/mojombo/jekyll">Jekyll</a>
	</div>
</footer>

<script type="text/javascript">
	var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
	document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
	</script>
	<script type="text/javascript">
	try {
	  var pageTracker = _gat._getTracker("UA-37744723-1");
	pageTracker._trackPageview();
	} catch(err) {}
</script>


	</body>
</html>
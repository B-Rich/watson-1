<!doctype html>
<html>
	<head>
		<title>Forms -  Common Usage -  Watson Documentation</title>
		<link rel="stylesheet" type="text/css" href="/watson/assets/css/main.css" />
		<link rel="stylesheet" type="text/css" href="/watson/assets/css/pygments.css" />
		<meta name="viewport" content="initial-scale=1, user-scalable=no, width=device-width" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	</head>
	<body>
		<a href="https://github.com/simoncoulton/watson"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>
<header>
	<nav class="wrapper primary">
		<a href="/watson/">Watson<span>It's elementary my dear Watson</span></a>
		<a href="/watson/reference-library">Reference Library</a>
		<a href="/watson/key-concepts">Key Concepts</a>
		<a href="/watson/getting-started">Getting Started</a>
	</nav>
	<div class="pagetitle">
		<div class="wrapper">Documentation: Common Usage</div>
	</div>
</header>
		<div>
			<div class="wrapper main clearfix">
				<nav class="secondary">
	<ul>
		<li>
			Getting Started
			<ul>
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			      <li>
			        <a href="/watson/getting-started/installation.html">
			          Installation
			        </a>
			      </li>
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			      <li>
			        <a href="/watson/getting-started/configuration.html">
			          Configuration
			        </a>
			      </li>
			    
			  
			    
			  
			    
			  
			    
			  
			    
			      <li>
			        <a href="/watson/getting-started/your-first-application.html">
			          Your First Application
			        </a>
			      </li>
			    
			  
			    
			  
			    
			  
			</ul>
		</li>
		<li>
			Key Concepts
			<ul>
				
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			      <li>
			        <a href="/watson/key-concepts/events.html">
			          Events
			        </a>
			      </li>
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			      <li>
			        <a href="/watson/key-concepts/dependencyinjection.html">
			          Dependency Injection
			        </a>
			      </li>
			    
			  
			    
			  
			    
			      <li>
			        <a href="/watson/key-concepts/mvc.html">
			          Mvc
			        </a>
			      </li>
			    
			  
			    
			  
			    
			  
			    
			  
			</ul>
		</li>
		<li>
			Common Usage
			<ul>
				
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			      <li>
			        <a href="/watson/common-usage/controllers.html">
			          Controllers
			        </a>
			      </li>
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			      <li>
			        <a href="/watson/common-usage/views.html">
			          Views
			        </a>
			      </li>
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			      <li>
			        <a href="/watson/common-usage/routing.html">
			          Routing
			        </a>
			      </li>
			    
			  
			    
			  
			    
			  
			    
			      <li>
			        <a href="/watson/common-usage/requests.html">
			          Requests
			        </a>
			      </li>
			    
			  
			    
			      <li class="active">
			        <a href="/watson/common-usage/forms.html">
			          Forms
			        </a>
			      </li>
			    
			  
			</ul>
		</li>
		<li>
			Advanced Topics
			<ul>
				
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			      <li>
			        <a href="/watson/advanced-topics/deployment.html">
			          Deployment
			        </a>
			      </li>
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			</ul>
		</li>
		<li>
			Reference Library
			<ul>
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				<li>
					<a href="/watson/reference-library/cache">watson.cache</a>
				</li>
				
				
				
				
				
				
				
				
				
				
				
				<li>
					<a href="/watson/reference-library/common">watson.common</a>
				</li>
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				<li>
					<a href="/watson/reference-library/di">watson.di</a>
				</li>
				
				
				
				
				
				
				
				
				
				
				
				<li>
					<a href="/watson/reference-library/events">watson.events</a>
				</li>
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				<li>
					<a href="/watson/reference-library/filters">watson.filters</a>
				</li>
				
				
				
				
				
				
				<li>
					<a href="/watson/reference-library/form">watson.form</a>
				</li>
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				<li>
					<a href="/watson/reference-library/html">watson.html</a>
				</li>
				
				
				
				
				
				
				
				
				
				
				
				<li>
					<a href="/watson/reference-library/http">watson.http</a>
				</li>
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				<li>
					<a href="/watson/reference-library/mvc">watson.mvc</a>
				</li>
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				<li>
					<a href="/watson/reference-library/util">watson.util</a>
				</li>
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				<li>
					<a href="/watson/reference-library/validators">watson.validators</a>
				</li>
				
				
				
				
			</ul>
		</li>
	</ul>
</nav>
			    <div class="content">
			    	<h2 class="section-title">Forms</h2>
					<p><section></p>

<p>Forms are defined in a declarative way within Watson. This means that you only need to define fields you want without any other boilerplate code.</p>

<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">watson</span> <span class="kn">import</span> <span class="n">form</span>
<span class="kn">from</span> <span class="nn">watson.form</span> <span class="kn">import</span> <span class="n">fields</span>

<span class="k">class</span> <span class="nc">Login</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;Username&#39;</span><span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Password</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;Password&#39;</span><span class="p">)</span>
    <span class="n">submit</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Submit</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#39;Login&#39;</span><span class="p">,</span> <span class="n">button_mode</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div>

<p>Which when implemented in a view would output:</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;form&gt;</span>
            <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;username&quot;</span><span class="nt">&gt;</span>Username<span class="nt">&lt;/label&gt;&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;username&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">&quot;password&quot;</span><span class="nt">&gt;</span>Password<span class="nt">&lt;/label&gt;&lt;input</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">name=</span><span class="s">&quot;password&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">&quot;submit&quot;</span><span class="nt">&gt;</span>Login<span class="nt">&lt;/button&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div>

<h4 id="toc_0">Field types</h4>

<p>Fields are referenced by their HTML element name. Whenever a field is defined within a form any additional keyword arguments are used as attributes on the element itself. Current fields that are included are:</p>

<table><thead>
<tr>
<th>Field</th>
<th>Output</th>
</tr>
</thead><tbody>
<tr>
<td>Input</td>
<td><input type="" /></td>
</tr>
<tr>
<td>Button</td>
<td><button></button></td>
</tr>
<tr>
<td>Textarea</td>
<td><textarea></textarea></td>
</tr>
<tr>
<td>Select</td>
<td><select></select></td>
</tr>
</tbody></table>

<p>There are also a bunch of convenience classes as well which may add additional validators and filters to the field.</p>

<table><thead>
<tr>
<th>Field</th>
<th>Output</th>
</tr>
</thead><tbody>
<tr>
<td>Radio</td>
<td><input type="radio" /></td>
</tr>
<tr>
<td>Checkbox</td>
<td><input type="checkbox" /></td>
</tr>
<tr>
<td>Submit</td>
<td><input type="submit" /> or <button>Submit</button></td>
</tr>
<tr>
<td>Text</td>
<td><input type="text" /></td>
</tr>
<tr>
<td>Date</td>
<td><input type="date" /></td>
</tr>
<tr>
<td>Email</td>
<td><input type="email" /></td>
</tr>
<tr>
<td>Hidden</td>
<td><input type="hidden" /></td>
</tr>
<tr>
<td>Csrf</td>
<td><input type="hidden" /></td>
</tr>
<tr>
<td>Password</td>
<td><input type="password" /></td>
</tr>
<tr>
<td>File</td>
<td><input type="file" /></td>
</tr>
</tbody></table>

<p>These can all be imported from the <code>watson.form.fields</code> module.</p>

<h3 id="toc_1">Populating and binding objects to a form</h3>

<p>Form data can be populated with any standard Python dict.</p>

<div class="highlight"><pre><code class="python"><span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">Login</span><span class="p">()</span>
<span class="n">form</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;username&#39;</span><span class="p">:</span> <span class="s">&#39;Simon&#39;</span><span class="p">}</span>
</code></pre></div>

<p>These values can then be retrieved by:</p>

<div class="highlight"><pre><code class="python"><span class="n">form</span><span class="o">.</span><span class="n">username</span><span class="o">.</span><span class="n">value</span>  <span class="c"># Simon</span>
</code></pre></div>

<p>If the field has been through the validation/filter process, you can still retrieve the original value that was submitted by:</p>

<div class="highlight"><pre><code class="python"><span class="n">form</span><span class="o">.</span><span class="n">username</span><span class="o">.</span><span class="n">original_value</span>  <span class="c"># Simon</span>
</code></pre></div>

<h4 id="toc_2">Binding an object to the form</h4>

<p>Sometimes it&#39;s worth being able to bind an object to the form so that any posted data can automatically be injected into the object. This is a relatively simple task to achieve:</p>

<p><span class="sub">Object entities</span></p>

<div class="highlight"><pre><code class="python"><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">password</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">email</span> <span class="o">=</span> <span class="bp">None</span>
</code></pre></div>

<p><span class="sub">Edit user form</span></p>

<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">watson</span> <span class="kn">import</span> <span class="n">form</span>
<span class="kn">from</span> <span class="nn">watson.form</span> <span class="kn">import</span> <span class="n">fields</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;Username&#39;</span><span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Password</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;Password&#39;</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Email</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;Email Address&#39;</span><span class="p">)</span>
</code></pre></div>

<p><span class="sub">Controller responsible for saving the user</span></p>

<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">watson.mvc</span> <span class="kn">import</span> <span class="n">controllers</span>
<span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">forms</span>

<span class="k">class</span> <span class="nc">Login</span><span class="p">(</span><span class="n">controllers</span><span class="o">.</span><span class="n">Rest</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">POST</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">()</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">User</span><span class="p">(</span><span class="s">&#39;user&#39;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">post</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>  <span class="c"># save the updated user data</span>
</code></pre></div>

<p>When is_valid() is called the POST&#39;d data will be injected directly into the User object. While this is great for simple CRUD interfaces, things can get more complex when an object contains other objects. To resolve this we have to define a mapping to map the flat post data to the various objects (we only need to define the mapping for data that isn&#39;t a direct mapping).</p>

<p>A basic mapping consists of a dict of key/value pairs where the value is a tuple that denotes the object &#39;tree&#39;.</p>

<div class="highlight"><pre><code class="python"><span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;field_name&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;attribute&#39;</span><span class="p">,</span> <span class="s">&#39;attribute&#39;</span><span class="p">,</span> <span class="s">&#39;attribute&#39;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>

<p>We&#39;ll take the same example from above, but modify it slightly so that our User object now also contains a Contact object (note that some of this code such as the entities would be handled automatically by your ORM of choice).</p>

<p><span class="sub">Object entities</span></p>

<div class="highlight"><pre><code class="python"><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">password</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">contact</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contact</span> <span class="o">=</span> <span class="n">Contact</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Contact</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">email</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="n">phone</span> <span class="o">=</span> <span class="bp">None</span>
</code></pre></div>

<p><span class="sub">Edit user form</span></p>

<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">watson</span> <span class="kn">import</span> <span class="n">form</span>
<span class="kn">from</span> <span class="nn">watson.form</span> <span class="kn">import</span> <span class="n">fields</span>

<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;Username&#39;</span><span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Password</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;Password&#39;</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Email</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;Email Address&#39;</span><span class="p">)</span>
    <span class="n">phone</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Email</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;Phone Number&#39;</span><span class="p">)</span>
</code></pre></div>

<p><span class="sub">Controller responsible for saving the user</span></p>

<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">watson.mvc</span> <span class="kn">import</span> <span class="n">controllers</span>
<span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">forms</span>

<span class="k">class</span> <span class="nc">Login</span><span class="p">(</span><span class="n">controllers</span><span class="o">.</span><span class="n">Rest</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">POST</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="p">()</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">User</span><span class="p">(</span><span class="s">&#39;user&#39;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="p">{</span><span class="s">&#39;email&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;contact&#39;</span><span class="p">,</span> <span class="s">&#39;email&#39;</span><span class="p">),</span> <span class="s">&#39;phone&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;contact&#39;</span><span class="p">,</span> <span class="s">&#39;phone&#39;</span><span class="p">)})</span>
        <span class="n">form</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">post</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>  <span class="c"># save the updated user data</span>
</code></pre></div>

<h3 id="toc_3">Filters and Validators</h3>

<p>Filters and validators allow you to sanitize and modify your data prior to being used within your application. By default, all fields have the Trim filter which removes whitespace from the value of the field.</p>

<p>When the is_valid() method is called on the form each field is filtered, and then validated.</p>

<p>To add new validators and filters to a field you simply add them as a keyword argument to the field definition.</p>

<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">watson</span> <span class="kn">import</span> <span class="n">form</span>
<span class="kn">from</span> <span class="nn">watson.form</span> <span class="kn">import</span> <span class="n">fields</span>
<span class="kn">from</span> <span class="nn">watson</span> <span class="kn">import</span> <span class="n">validators</span>

<span class="k">class</span> <span class="nc">Login</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;Username&#39;</span><span class="p">,</span> <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">Length</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">10</span><span class="p">)])</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Password</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;Password&#39;</span><span class="p">,</span> <span class="n">validators</span><span class="o">=</span><span class="p">[</span><span class="n">Required</span><span class="p">()])</span>
    <span class="c"># required can actually be set via required=True</span>
    <span class="n">submit</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Submit</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#39;Login&#39;</span><span class="p">,</span> <span class="n">button_mode</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div>

<p>For a full list of validators and filters check out <a href="/watson/reference-library/filters.html">filters</a> and <a href="/watson/reference-library/validators.html">validators</a> in the reference library.</p>

<h3 id="toc_4">Validating post data</h3>

<p>Validating forms is usually done within a controller. We&#39;ll utilize the Login form above to demonstrate this...</p>

<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">watson.mvc</span> <span class="kn">import</span> <span class="n">controllers</span>
<span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">forms</span>

<span class="k">class</span> <span class="nc">Login</span><span class="p">(</span><span class="n">controllers</span><span class="o">.</span><span class="n">Rest</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">GET</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">Login</span><span class="p">(</span><span class="s">&#39;login_form&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;/login&#39;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redirect_vars</span>
        <span class="c"># populate the form with POST&#39;d data to avoid the PRG issue</span>
        <span class="c"># we don&#39;t really need to do this</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">POST</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">Login</span><span class="p">(</span><span class="s">&#39;login_form&#39;</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">post</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">flash_messages</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&#39;Successfully logged in&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redirect</span><span class="p">(</span><span class="s">&#39;home&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">redirect</span><span class="p">(</span><span class="s">&#39;login&#39;</span><span class="p">)</span>
</code></pre></div>

<p>With the above code, when a user hits /login, they are presented with a login form from the GET method of the controller. As they submit the form, the code within the POST method will execute. If the form is valid, then they will be redirected to whatever the &#39;home&#39; route displays, otherwise they will be redirected back to the GET method again.</p>

<h4 id="toc_5">Errors upon validating</h4>

<p>When is_valid() is called, all fields will be filtered and validated, and any subsequent error messages will be available via <code>form.errors</code>.</p>

<h3 id="toc_6">Protecting against CSRF (Cross site request forgery)</h3>

<p><a href="https://en.wikipedia.org/wiki/Cross-site_request_forgery">Cross site request forgery</a> is a big issue with a lot of code bases. Watson provides a simple way to protect your users against it by using a decorator.</p>

<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">watson</span> <span class="kn">import</span> <span class="n">form</span>
<span class="kn">from</span> <span class="nn">watson.form</span> <span class="kn">import</span> <span class="n">fields</span>
<span class="kn">from</span> <span class="nn">watson.form.decorators</span> <span class="kn">import</span> <span class="n">has_csrf</span>

<span class="nd">@has_csrf</span>
<span class="k">class</span> <span class="nc">Login</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;Username&#39;</span><span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Password</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;Password&#39;</span><span class="p">)</span>
    <span class="n">submit</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Submit</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">&#39;Login&#39;</span><span class="p">,</span> <span class="n">button_mode</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div>

<p>The above code will automatically add a new field (named csrf_token) to the form, which then will need to be rendered in your view. You will also need to pass the session into the form when it is instantiated so that the csrf token can be saved against the form.</p>

<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">watson.mvc</span> <span class="kn">import</span> <span class="n">controllers</span>
<span class="kn">from</span> <span class="nn">app</span> <span class="kn">import</span> <span class="n">forms</span>

<span class="k">class</span> <span class="nc">Login</span><span class="p">(</span><span class="n">controllers</span><span class="o">.</span><span class="n">Rest</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">GET</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">Login</span><span class="p">(</span><span class="s">&#39;login_form&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;/login&#39;</span><span class="p">,</span> <span class="n">session</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="p">)</span>
        <span class="n">form</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redirect_vars</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span>
        <span class="p">}</span>
</code></pre></div>

<p>As the form is validated (via is_valid()), the token will automatically be processed against the csrf validator.</p>

<p></section></p>


				</div>
			</div>
		</div>
		<footer>
	<div class="sub">
		<div class="wrapper clearfix">
			<ul>
				<li class="title">Source </li>
				<li><a href="https://github.com/simoncoulton/watson">GitHub</a></li>
				<li><a href="https://pypi.python.org/pypi/watson-framework/">Pypi</a></li>
			</ul>
			<ul>
				<li class="title">Testing</li>
				<li><a href="https://coveralls.io/r/simoncoulton/watson">Coverage</a></li>
				<li><a href="https://travis-ci.org/simoncoulton/watson">Travis CI</a></li>
			</ul>
			<ul>
				<li class="title">Useful Resources</li>
				<li><a href="http://docs.python.org/3/">Python 3 Documentation</a></li>
				<li><a href="http://www.reddit.com/r/python">Python Subreddit</a></li>

			</ul>
		</div>
	</div>
	<div class="wrapper">
		Design thanks to <a href="http://www.blazrobar.com">Blaz Robar</a>
		<br />Content generated by <a href="https://github.com/mojombo/jekyll">Jekyll</a>
	</div>
</footer>

<script type="text/javascript">
	var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
	document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
	</script>
	<script type="text/javascript">
	try {
	  var pageTracker = _gat._getTracker("UA-37744723-1");
	pageTracker._trackPageview();
	} catch(err) {}
</script>


	</body>
</html>

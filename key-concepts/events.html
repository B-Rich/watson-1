<!doctype html>
<html>
	<head>
		<title>Events -  Key Concepts -  Watson Documentation</title>
		<link rel="stylesheet" type="text/css" href="/watson/assets/css/main.css" />
		<link rel="stylesheet" type="text/css" href="/watson/assets/css/pygments.css" />
		<meta name="viewport" content="initial-scale=1, user-scalable=no, width=device-width" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	</head>
	<body>
		<a href="https://github.com/simoncoulton/watson"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>
<header>
	<nav class="wrapper primary">
		<a href="/watson/">Watson<span>It's elementary my dear Watson</span></a>
		<a href="/watson/reference-library">Reference Library</a>
		<a href="/watson/key-concepts">Key Concepts</a>
		<a href="/watson/getting-started">Getting Started</a>
	</nav>
	<div class="pagetitle">
		<div class="wrapper">Documentation: Key Concepts</div>
	</div>
</header>
		<div>
			<div class="wrapper main clearfix">
				<nav class="secondary">
	<ul>
		<li>
			Getting Started
			<ul>
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			      <li>
			        <a href="/watson/getting-started/installation.html">
			          Installation
			        </a>
			      </li>
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			      <li>
			        <a href="/watson/getting-started/configuration.html">
			          Configuration
			        </a>
			      </li>
			    
			  
			    
			  
			    
			  
			    
			      <li>
			        <a href="/watson/getting-started/your-first-application.html">
			          Your First Application
			        </a>
			      </li>
			    
			  
			</ul>
		</li>
		<li>
			Key Concepts
			<ul>
				
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			      <li class="active">
			        <a href="/watson/key-concepts/events.html">
			          Events
			        </a>
			      </li>
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			      <li>
			        <a href="/watson/key-concepts/dependencyinjection.html">
			          Dependency Injection
			        </a>
			      </li>
			    
			  
			    
			      <li>
			        <a href="/watson/key-concepts/mvc.html">
			          Mvc
			        </a>
			      </li>
			    
			  
			    
			  
			</ul>
		</li>
		<li>
			Common Usage
			<ul>
				
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			      <li>
			        <a href="/watson/common-usage/controllers.html">
			          Controllers
			        </a>
			      </li>
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			      <li>
			        <a href="/watson/common-usage/requests.html">
			          Requests
			        </a>
			      </li>
			    
			  
			    
			      <li>
			        <a href="/watson/common-usage/routing.html">
			          Routing
			        </a>
			      </li>
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			      <li>
			        <a href="/watson/common-usage/views.html">
			          Views
			        </a>
			      </li>
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			</ul>
		</li>
		<li>
			Advanced Topics
			<ul>
				
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			      <li>
			        <a href="/watson/advanced-topics/deployment.html">
			          Deployment
			        </a>
			      </li>
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			    
			  
			</ul>
		</li>
		<li>
			Reference Library
			<ul>
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				<li>
					<a href="/watson/reference-library/cache">watson.cache</a>
				</li>
				
				
				
				
				
				
				
				
				
				
				
				<li>
					<a href="/watson/reference-library/common">watson.common</a>
				</li>
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				<li>
					<a href="/watson/reference-library/di">watson.di</a>
				</li>
				
				
				
				
				
				
				
				
				
				
				
				<li>
					<a href="/watson/reference-library/events">watson.events</a>
				</li>
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				<li>
					<a href="/watson/reference-library/filters">watson.filters</a>
				</li>
				
				
				
				
				
				
				<li>
					<a href="/watson/reference-library/form">watson.form</a>
				</li>
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				<li>
					<a href="/watson/reference-library/html">watson.html</a>
				</li>
				
				
				
				
				
				
				
				
				
				
				
				<li>
					<a href="/watson/reference-library/http">watson.http</a>
				</li>
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				<li>
					<a href="/watson/reference-library/mvc">watson.mvc</a>
				</li>
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				<li>
					<a href="/watson/reference-library/util">watson.util</a>
				</li>
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				
				<li>
					<a href="/watson/reference-library/validators">watson.validators</a>
				</li>
				
				
				
				
			</ul>
		</li>
	</ul>
</nav>
			    <div class="content">
			    	<h2 class="section-title">Events</h2>
					<section>
<p>Events are a major part of how Watson wires together your application. You can hook into the events and register your own event listeners by modifying your application configuration.</p>

<p>The event dispatcher holds a record of all listeners and the their associated priority, number of executions, and the event name that they are to be executed on.</p>

<p>The basic flow for the event system within Watson is the following:</p>

<blockquote>
<p>Create dispatcher &gt; Add listeners &gt; Trigger event &gt; Return results from triggered listeners</p>
</blockquote>

<h3>The anatomy of an Event</h3>

<p>An event is used to pass around data within an application without introducing a tight coupling between objects. A basic event contains the following:</p>

<ul>
<li>A name <span class="sub">The name of the event that will trigger listener callbacks</span></li>
<li>A target <span class="sub">What triggered the event</span></li>
<li>A set of parameters <span class="sub">Data sent through with the event</span></li>
</ul>

<p>When an event is triggered from an event dispatcher, all listeners that are listening for a particular event name will be triggered and their responses returned.</p>

<h3>Inbuilt events</h3>

<p>The lifecycle of a Watson application is maintained by 5 different events (defined in <em>watson.mvc.events</em>:</p>

<ul>
<li>event.mvc.init <span class="sub">Triggered when the application is started</span></li>
<li>event.mvc.route.match <span class="sub">Triggered when the application attempts to route a request and returns the matches</span></li>
<li>event.mvc.dispatch.execute <span class="sub">Triggered when the controller is executed and returns the response</span></li>
<li>event.mvc.render.view <span class="sub">Triggered when the controller response is processed and the view is rendered</span></li>
<li>event.mvc.exception <span class="sub">Triggered when any exception occurs within the application and the executes prior to the render view to generate any 400/500 error pages</span></li>
</ul>

<p>These events are triggered by the shared_event_dispatcher which is instantiated from the applications IocContainer.</p>

<h3>Creating and registering your own event listeners</h3>

<p>By default several listeners are defined within the <em>watson.mvc.config</em> module, however additional listeners can be added to these events, and even prevent the default listeners from being triggered.</p>

<p>Let&#39;s assume that we want to add a new listener to the watson.mvc.events.INIT event. First lets add a new events key to the applications configuration module. Replace app_name with the applications name.</p>

<p><span class="sub">app_name/config/config.py</span></p>

<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">watson.mvc</span> <span class="kn">import</span> <span class="n">events</span>

<span class="n">events</span> <span class="o">=</span> <span class="p">{</span>
<span class="p">}</span>
</code></pre></div>

<blockquote>
<p>Note that whatever defined in here will be <strong>appended</strong> to Watsons default configuration.</p>
</blockquote>

<p>Next, we&#39;ll need to create a listener, which just needs to be a callable object. As the listener is going to be retrieved from the IocContainer, it is useful to subclass watson.di.ContainerAware so that the container will be injected automatically. The triggered listener is passed a single event as the argument, so make sure that you allow for that.</p>

<p><span class="sub">app_name/listeners.py</span></p>

<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">watson.di</span> <span class="kn">import</span> <span class="n">ContainerAware</span>
<span class="kn">from</span> <span class="nn">watson.mvc</span> <span class="kn">import</span> <span class="n">listeners</span>

<span class="k">class</span> <span class="nc">MyFirstListener</span><span class="p">(</span><span class="n">listeners</span><span class="o">.</span><span class="n">Base</span><span class="p">,</span> <span class="n">ContainerAware</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="c"># we&#39;ll perform something based on the event and target here</span>
        <span class="k">pass</span>
</code></pre></div>

<p>Finally we&#39;ll need to register the listener with the event dispatcher. Each listener needs to be added as a tuple, which takes the following arguments: (object, int priority, boolean once_only). If no priority is specified a default priority of 1 will be given. The highest priority will be executed first. If only_once is not specified then it will default to False.</p>

<p><span class="sub">app_name/config/config.py</span></p>

<div class="highlight"><pre><code class="python"><span class="n">events</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">events</span><span class="o">.</span><span class="n">INIT</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">(</span><span class="s">&#39;app_name.listeners.MyFirstListener&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></div>

<p>Now once your application is initialized your event will be triggered.</p>

</section>

<section>
	
		
			
		
	
		
			
		
	
		
			
		
	

	
	<h4>See also:</h4>
	
	
	<a class="label blue" href="/watson/reference-library/events/types.html">watson.events.types</a>
	
	
	
	
	<a class="label blue" href="/watson/reference-library/events/collections.html">watson.events.collections</a>
	
	
	
	
	<a class="label blue" href="/watson/reference-library/events/dispatcher.html">watson.events.dispatcher</a>
	
	
	
	
</section>
				</div>
			</div>
		</div>
		<footer>
	<div class="sub">
		<div class="wrapper clearfix">
			<ul>
				<li class="title">Source </li>
				<li><a href="https://github.com/simoncoulton/watson">GitHub</a></li>
				<li><a href="https://pypi.python.org/pypi/watson-framework/">Pypi</a></li>
			</ul>
			<ul>
				<li class="title">Testing</li>
				<li><a href="https://coveralls.io/r/simoncoulton/watson">Coverage</a></li>
				<li><a href="https://travis-ci.org/simoncoulton/watson">Travis CI</a></li>
			</ul>
			<ul>
				<li class="title">Useful Resources</li>
				<li><a href="http://docs.python.org/3/">Python 3 Documentation</a></li>
				<li><a href="http://www.reddit.com/r/python">Python Subreddit</a></li>

			</ul>
		</div>
	</div>
	<div class="wrapper">
		Design thanks to <a href="http://www.blazrobar.com">Blaz Robar</a>
		<br />Content generated by <a href="https://github.com/mojombo/jekyll">Jekyll</a>
	</div>
</footer>

<script type="text/javascript">
	var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
	document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
	</script>
	<script type="text/javascript">
	try {
	  var pageTracker = _gat._getTracker("UA-37744723-1");
	pageTracker._trackPageview();
	} catch(err) {}
</script>


	</body>
</html>